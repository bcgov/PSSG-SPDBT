using System.Text.Json;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Shouldly;
using Spd.Utilities.Printing;

namespace Spd.Tests.Integration.Utilities;

public class BcMailPlusTests : IAsyncLifetime
{
    private IServiceScope serviceScope = null!;
    private IServiceProvider services => serviceScope.ServiceProvider;

    [Fact]
    public async Task CanPrintSecurityWorkerCertificate()
    {
        var printer = services.GetRequiredService<IPrinter>();
        var response = await printer.PrintAsync(new BcMailPlusPrintRequest(SecurityWorkerJobName, new[] { JsonDocument.Parse(SecurityWorkerPayload), JsonDocument.Parse(BusinessLicensePayload) }), CancellationToken.None);
        response.ShouldBeOfType<BcMailPlusPrintResponse>().Items.ShouldHaveSingleItem().ShouldNotBeNull();
    }

    public async Task DisposeAsync()
    {
        await Task.CompletedTask;
        serviceScope.Dispose();
    }

    public async Task InitializeAsync()
    {
        await Task.CompletedTask;
        var servicesCollection = new ServiceCollection();
        var configuration = new ConfigurationBuilder().AddUserSecrets(this.GetType().Assembly).Build();
        servicesCollection.AddSingleton<IConfiguration>(configuration);
        servicesCollection.AddPrinting(configuration);

        serviceScope = servicesCollection.BuildServiceProvider().CreateScope();
    }

    public const string SecurityWorkerJobName = "PSSG-SPD-CARD";
    public const string SecurityWorkerPayload = "{\r\n  \"licenceNumber\": \"E32456\",\r\n  \"licenceType\": \"Security Worker\",\r\n  \"applicationType\": \"New\",\r\n  \"photo\": \"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\",\r\n  \"licenceCategories\": [\"Security Guard\", \"Private Investigator\", \"Locksmith\"],\r\n  \"applicantName\": \"Alfred Shawn Berry\",\r\n  \"issuedDate\": \"2013-02-22\",\r\n  \"expiryDate\": \"2014-01-22\",\r\n  \"mailingAddress\": \"123 Yellow Brick Road, Vancouver BC V7H 1JE\",   \r\n  \"branchOffices\": \"\",\r\n  \"conditions\": [\"Authorized to carry and use restraints (handcuffs only)\", \"Must be in compliance with section 14 of the Security Services Regulation Code of Conduct\"],\r\n  \"eyes\": \"Brown\",\r\n  \"hair\": \"Black\",\r\n  \"height\": \"180 cm\",\r\n  \"weight\": \"85 kg\",\r\n  \"auditNumber\": \"\",\r\n  \"temporaryLicence\": true\r\n}";

    public const string BusinessLicenseJobName = "PSSG-SPD-BUS-LIC";
    public const string BusinessLicensePayload = "{\r\n  \"licenceNumber\": \"B1301\",\r\n  \"licenceType\": \"Security Business Licence\",\r\n  \"applicationType\": \"Renewal\",\r\n  \"photo\": \"\",\r\n  \"licenceCategories\": [\"Security Alaram Installer\", \"Security Alarm Sales\"],\r\n  \"applicantName\": \"INFRA-TECH ENTERPRISES LTD.\",\r\n  \"issuedDate\": \"2023-03-22\",\r\n  \"expiryDate\": \"2024-03-21\",\r\n  \"mailingAddress\": \"123 Yellow Brick Road, Vancouver BC V7H 1JE\",\r\n  \"branchOffices\": [\"1177 HORNBY STREET VANCOUVER BC V6Z 2E9\", \"5886 TURNSTONE CRES SECHELT BC V7Z 0L9\"],\r\n  \"conditions\": [\"This licence must be displayed in a conspicuous place within the licenced premises\", \"Must be in compliance with Section 14 of the Security Services Regulation Code of Conduct\"],\r\n  \"eyes\": \"\",\r\n  \"hair\": \"\",\r\n  \"height\": \"\",\r\n  \"weight\": \"\",\r\n  \"auditNumber\": \"1824046\" ,\r\n  \"temporaryLicence\": false\r\n}";
}